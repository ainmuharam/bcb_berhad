<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Test Approval</title>
<style>
.status-approved { color: green; font-weight: bold; }
.status-rejected { color: red; font-weight: bold; }
</style>
</head>
<body>

<table border="1">
  <tr data-id="123">
    <td>
      <select name="clock" id="clock-select">
        <option value="none">Select Clock</option>
        <option value="clockIn">Clock In</option>
        <option value="clockOut">Clock Out</option>
      </select>
    </td>
    <td>
      <select name="status" id="status-select" disabled>
        <option value="none">Select Status</option>
        <option value="Approved">Approved</option>
        <option value="Rejected">Rejected</option>
      </select>
    </td>
    <td class="status-cell"></td>
  </tr>
</table>

<script>
const row = document.querySelector('tr[data-id]');
const id = row.dataset.id;
const clockSelect = row.querySelector('#clock-select');
const statusSelect = row.querySelector('#status-select');
const statusCell = row.querySelector('.status-cell');

clockSelect.addEventListener('change', () => {
    if (clockSelect.value === "clockIn" || clockSelect.value === "clockOut") {
        statusSelect.disabled = false;
    } else {
        statusSelect.disabled = true;
        statusSelect.value = "none";
        statusCell.textContent = '';
    }
});

statusSelect.addEventListener('change', () => {
    const selectedValue = statusSelect.value;
    if (selectedValue === "Approved" || selectedValue === "Rejected") {
        const confirmMsg = `Are you sure you want to ${selectedValue.toLowerCase()} the request?`;
        if (!confirm(confirmMsg)) {
            statusSelect.value = "none";
            return;
        }

        proceedApproval(id, selectedValue, clockSelect.value, statusSelect, clockSelect);
    }
});

function proceedApproval(id, selectedValue, clockValue, selectElement, clockSelect) {
    fetch("test_status_manual_login.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `id=${encodeURIComponent(id)}&status=${encodeURIComponent(selectedValue)}&clock=${encodeURIComponent(clockValue)}`
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            statusCell.innerHTML = '';
            const newSpan = document.createElement('span');
            newSpan.textContent = selectedValue;
            newSpan.className = selectedValue === "Approved" ? "status-approved" : "status-rejected";
            statusCell.appendChild(newSpan);
            clockSelect.disabled = true;
            selectElement.disabled = true;
            alert(data.message);
        } else {
            alert(data.message);
            selectElement.value = "none";
        }
    })
    .catch(err => {
        alert("Error parsing response or network issue: " + err);
        console.error(err);
    });
}
</script>

</body>
</html>
